# hyperliquid多策略自动调仓机器人
根据 https://nof1.ai/  的启发， 编写一个由代码判断多策略（当前启用4种）自主调仓交易模型，代码尚未开源，需要执行一段时间验证正确性。

交易策略暂定四个：均线，RSI，MACD，布林带

## 1 模型算法：

## 模型算法有三种，权重模式，严格模式，多数模式。运行时只能使用一个模式

### 1.1 权重模式交易决策公式
权重预设详解:
<img width="1028" height="674" alt="QQ_1761397382486" src="https://github.com/user-attachments/assets/3ff0fcc7-34c5-44ea-9419-8aa80ab8052e" />

1.1.1 第一步：收集策略信号，假设有4个策略，每个策略发出信号：

🟢 买入 = +1分

🟡 持有 = 0分

🔴 卖出 = -1分

1.1.2. 第二步：乘以权重
   
   总买入分 = (策略1信号 × 权重1) + (策略2信号 × 权重2) + ...
   
   总卖出分 = (策略1信号 × 权重1) + (策略2信号 × 权重2) + ...
   
1.1.3. 第三步：计算信号强度

买入强度 = 总买入分 ÷ 总权重 

卖出强度 = 总卖出分 ÷ 总权重

1.1.4. 第四步：阈值判断

如果 买入强度 > 阈值 → 执行买入

如果 卖出强度 > 阈值 → 执行卖出

否则 → 持有

1.1.5. 实际计算示例
   
权重配置：MA(1.0), RSI(1.8), MACD(1.5), 布林(0.5)

信号情况：

MA: 🟢买入 → +1 × 1.0 = +1.0

RSI: 🟢买入 → +1 × 1.8 = +1.8

MACD: 🟡持有 → 0 × 1.5 = 0

布林: 🔴卖出 → -1 × 0.5 = -0.5

计算：

总权重 = 1.0 + 1.8 + 1.5 + 0.5 = 4.8

买入强度 = (1.0 + 1.8) ÷ 4.8 = 2.8 ÷ 4.8 ≈ 0.58

卖出强度 = (0.5) ÷ 4.8 ≈ 0.10

1.1.6 决策。当阈值0.6时，执行逻辑判断如下：

买入强度 0.58 < 0.60 → ❌不买入

卖出强度 0.10 < 0.60 → ❌不卖出

结果：🟡持有，不执行任何交易操作

### 1.2 严格模式 不受阈值限制

严格模式是针对当前启用策略的选择进行执行交易。

启用4个策略，运行时4个策略同时发出做多或做空，才会执行交易。低于4个相同方向则不操作。是一个非常保守的模式。尚未测试正确性，因为很难触发这个条件。

启用3个策略，需要3个策略都发出相同信号才执行交易逻辑。低于3个相同方向不操作。

### 1.3 多数模式 不受阈值限制

多数模式是超过半数策略的信号才会触发交易逻辑。

启用4个策略，如果有3个策略是做多信号，1个策略是做空信号，则执行买入逻辑。

如果2个策略发出做多信号，2个策略发出做空信号。则不会有任何操作，没有达到交易逻辑。

## 2 阈值与交易频率的关系 阈值仅作用于权重模式

阈值越低 → 越容易交易。信号强度要求更低，更频繁的交易触发更高的交易活跃度。但也可能增加错误信号的风险。

阈值越高 → 越难交易。信号强度要求更高，更严格的交易条件，减少交易频率。提高信号质量，但可能错过机会。

2.1 具体示例：

阈值 0.4（宽松）：单个高权重策略就可能触发交易，2个中等权重策略就能达到阈值，交易频率：⚡⚡⚡⚡（高）

阈值 0.6（适中）：需要多个策略一致支持，交易质量相对较高，交易频率：⚡⚡⚡（中）

阈值 0.8（严格）：需要几乎所有策略强烈一致，极少触发交易，但信号质量很高，交易频率：⚡（低）

极限情况：阈值不能低于0.33，否则会发出严重失真策略信号，导致交易方向错误。

建议设置：

激进型：0.5-0.6

平衡型：0.6-0.7

保守型：0.7-0.8


## 3 下载的历史价格数据（发出策略信号的关键）

策略生成信号的历史数据来自于coingecko下载api接口

策略信号计算（均线、RSI、MACD、布林带）基于最新的100个历史数据点，相当于最近3个月（每日间隔）。

保守使用60个数据点。低于60个数据点不会执行交易模块。以防守下载失败或少量数据时产生失真信号导致交易方向错误。

## 4 初版运行状态
<img width="2844" height="1644" alt="QQ_1761294877955" src="https://github.com/user-attachments/assets/b24367e9-8497-499c-9e03-c59b1d08b825" />

4.1 修复代码，已严格控制保证金在风险范围内开仓
<img width="2042" height="1398" alt="QQ_1761376251278" src="https://github.com/user-attachments/assets/945dde0e-5da6-46ea-bcbc-3a3d12f68461" />

## 5 更新日志
###  2025-10-25 添加了空翻多，多翻空的自动判断执行逻辑，空翻多的信号策略已触发并正确执行。
### 下午17:33 触发空翻多的逻辑并根据策略信号正确执行了交易。平掉空头并执行买入策略后，下一轮检测还没达到风险控制的20%，触发加仓的策略的。
<img width="1958" height="1352" alt="QQ_1761472816706" src="https://github.com/user-attachments/assets/12517808-2888-4c0a-b111-1a0602d6e18b" />
<img width="1910" height="1234" alt="QQ_1761472929114" src="https://github.com/user-attachments/assets/89ea1d44-a84a-4081-b3f6-a8ee5a81def7" />
<img width="2296" height="406" alt="QQ_1761473402561" src="https://github.com/user-attachments/assets/8c76bd91-8f87-4247-b26a-ae59b5ae627b" />


###  2025-10-26 1.解决hyperliquid在精度问题下单失败的问题，精度问题包括币种下单数量，下单价格的精度问题
###  2025-10-26 2.加仓逻辑处理：当某个币种使用保证金低于总保证金的20%，同时又发出强烈的交易信号，自动执行加仓策略，同时控制总风险还在20%范围内。即使返回交易失败信息也需要检查持仓是否增加
<img width="2266" height="1308" alt="QQ_1761448540022" src="https://github.com/user-attachments/assets/3eef1c45-5a0e-475c-8d97-a7d5fbcd386d" />





