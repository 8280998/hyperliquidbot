# hyperliquid多策略自动调仓机器人
根据 https://nof1.ai/  的启发， 编写一个由代码判断多策略（当前启用4种）自主调仓交易模型，代码尚未开源，需要执行一段时间验证正确性。

交易策略暂定四个：均线，RSI，MACD，布林带

✅ 均线策略：基于移动平均线的趋势跟踪。短期均线上穿/下穿长期均线产生信号，买入：短均线 > 长均线 且 价格 > 短均线  ｜卖出：短均线 < 长均线 且 价格 < 短均线

✅ RSI策略：相对强弱指标，识别超买超卖。超买区域：RSI > 70，考虑卖出 ｜超卖区域：RSI < 30，考虑买入｜中性区域：RSI 45-55，持有。

✅ MACD策略：移动平均收敛散度，趋势动量。MACD线与信号线的交叉，金叉：MACD > 信号线，买入信号 ｜死叉：MACD < 信号线，卖出信号

✅ 布林策略：布林带，波动率策略。价格在布林带中的位置，上轨突破：价格 > 上轨，卖出信号 ｜下轨突破：价格 < 下轨，买入信号 ｜中轨附近：价格接近中轨，持有

## 1 模型算法：

## 模型算法有三种，权重模式，严格模式，多数模式。运行时只能使用一个模式

### 1.1 权重模式交易决策公式
权重预设详解:
<img width="1028" height="674" alt="QQ_1761397382486" src="https://github.com/user-attachments/assets/3ff0fcc7-34c5-44ea-9419-8aa80ab8052e" />

1.1.1 第一步：收集策略信号，假设有4个策略，每个策略发出信号：

🟢 买入 = +1分

🟡 持有 = 0分

🔴 卖出 = -1分

1.1.2. 第二步：乘以权重
   
   总买入分 = (策略1信号 × 权重1) + (策略2信号 × 权重2) + ...
   
   总卖出分 = (策略1信号 × 权重1) + (策略2信号 × 权重2) + ...
   
1.1.3. 第三步：计算信号强度

买入强度 = 总买入分 ÷ 总权重 

卖出强度 = 总卖出分 ÷ 总权重

1.1.4. 第四步：阈值判断

如果 买入强度 > 阈值 → 执行买入

如果 卖出强度 > 阈值 → 执行卖出

否则 → 持有

1.1.5. 实际计算示例
   
权重配置：MA(1.0), RSI(1.8), MACD(1.5), 布林(0.5)

信号情况：

MA: 🟢买入 → +1 × 1.0 = +1.0

RSI: 🟢买入 → +1 × 1.8 = +1.8

MACD: 🟡持有 → 0 × 1.5 = 0

布林: 🔴卖出 → -1 × 0.5 = -0.5

计算：

总权重 = 1.0 + 1.8 + 1.5 + 0.5 = 4.8

买入强度 = (1.0 + 1.8) ÷ 4.8 = 2.8 ÷ 4.8 ≈ 0.58

卖出强度 = (0.5) ÷ 4.8 ≈ 0.10

1.1.6 决策。当阈值0.6时，执行逻辑判断如下：

买入强度 0.58 < 0.60 → ❌不买入

卖出强度 0.10 < 0.60 → ❌不卖出

结果：🟡持有，不执行任何交易操作

### 1.2 严格模式 不受阈值限制

严格模式是针对当前启用策略的选择进行执行交易。

启用4个策略，运行时4个策略同时发出做多或做空，才会执行交易。低于4个相同方向则不操作。是一个非常保守的模式。尚未测试正确性，因为很难触发这个条件。

启用3个策略，需要3个策略都发出相同信号才执行交易逻辑。低于3个相同方向不操作。

### 1.3 多数模式 不受阈值限制

多数模式是超过半数策略的信号才会触发交易逻辑。

启用4个策略，如果有3个策略是做多信号，1个策略是做空信号，则执行买入逻辑。

如果2个策略发出做多信号，2个策略发出做空信号。则不会有任何操作，没有达到交易逻辑。

## 2 信号阈值与交易频率的关系 阈值仅作用于权重模式

阈值越低 → 越容易交易。信号强度要求更低，更频繁的交易触发更高的交易活跃度。但也可能增加错误信号的风险。

阈值越高 → 越难交易。信号强度要求更高，更严格的交易条件，减少交易频率。提高信号质量，但可能错过机会。

### 具体示例：

阈值 0.4（宽松）：单个高权重策略就可能触发交易，2个中等权重策略就能达到阈值，交易频率：⚡⚡⚡⚡（高）

阈值 0.6（适中）：需要多个策略一致支持，交易质量相对较高，交易频率：⚡⚡⚡（中）

阈值 0.8（严格）：需要几乎所有策略强烈一致，极少触发交易，但信号质量很高，交易频率：⚡（低）

极限情况：阈值不能低于0.33，否则会发出严重失真策略信号，导致交易方向错误。

建议设置：

激进型：0.5-0.6

平衡型：0.6-0.7

保守型：0.7-0.8

## 3 止盈阈值  在现有信号强度基础上增加止盈判断条件（目前只是理想状态，在测试网中运行尚未触发到这个条件）
0.0-0.49 : 不交易（在信号阈值0.5默认情况下视为无效信号）

0.5-0.6 : 正常交易，正常止盈  ｜当前盈亏: +18%✅ (达到止盈条件)｜信号强度: 0.58｜决策: 执行止盈 ✅

0.61+   : 强信号，跳过止盈让利润加速增长 ｜当前盈亏: +19% ✅ (已超过18%止盈线)｜信号强度: 0.72｜决策: 跳过止盈，继续持仓赚取更大利润｜理由: 趋势强劲，可能还有更大上涨空间

止盈阈值策略的优势：

避免过早止盈：强趋势中不因固定止盈比例而错过更大行情

动态风险控制：根据市场动能智能调整止盈时机

趋势跟踪友好：符合"让利润加速奔跑，截断亏损"的交易理念

量化决策：避免情绪化止盈，完全基于信号强度决策。人性的情绪化操作很可怕，远远不如代码按条件执行

在信号阈值0.5的决策条件下，设置止盈阈值数值如下产生的效果：
<img width="1104" height="710" alt="QQ_1761529852451" src="https://github.com/user-attachments/assets/e1e2608e-7378-4bed-897a-097e292815d0" />



## 4 下载的历史价格数据（发出策略信号的关键）

策略生成信号的历史数据来自于coingecko下载api接口

策略信号计算（均线、RSI、MACD、布林带）基于最新的100个历史数据点，相当于最近3个月（每日间隔）。

保守使用60个数据点。低于60个数据点不会执行交易模块。以防守下载失败或少量数据时产生失真信号导致交易方向错误。

## 配置的时效性 
以每次循环时重新读取为主，可以在运行过程灵活修改参数而不需要重启程序，每次循环时间为60秒

配置类型     	读取参数	 

止盈信号阈值	  每次循环时	 

策略权重	     程序开始/重载时	

交易列表       每次循环时	

风险参数	    每次循环时


## 6 初版运行状态
<img width="2844" height="1644" alt="QQ_1761294877955" src="https://github.com/user-attachments/assets/b24367e9-8497-499c-9e03-c59b1d08b825" />

5.1 修复代码，已严格控制保证金在风险范围内开仓
<img width="2042" height="1398" alt="QQ_1761376251278" src="https://github.com/user-attachments/assets/945dde0e-5da6-46ea-bcbc-3a3d12f68461" />

## 6 更新日志
###  2025-10-25 添加了空翻多，多翻空的自动判断执行逻辑，空翻多的信号策略已触发并正确执行。
### 下午17:33 触发空翻多的逻辑并根据策略信号正确执行了交易。平掉空头并执行买入策略后，下一轮检测还没达到风险控制的20%，触发加仓的策略的。
###  2025-10-26 1.解决hyperliquid在精度问题下单失败的问题，精度问题包括币种下单数量，下单价格的精度问题
###  2025-10-26 2.加仓逻辑处理：当某个币种使用保证金低于总保证金的20%，同时又发出强烈的交易信号，自动执行加仓策略，同时控制总风险还在20%范围内。即使返回交易失败信息也需要检查持仓是否增加
### 2025-10-27 增加一个止盈阈值控制。在现有信号强度基础上增加止盈判断条件。

## 实盘测试 2025-10-30启动
实盘地址：https://hypurrscan.io/address/0x8aDaCE41Ec579423F149d7402f282301fCFaFF36

实盘使用保守的平衡稳定策略，权重值设置为：1.5,1.2,1.0,0.8。交易币种为BTC，ETH，BNB，SOL，DOGE，XPR。策略发出的信号阈值为0.55。止盈信号阈值为0.65
<img width="1968" height="1304" alt="QQ_1761818535132" src="https://github.com/user-attachments/assets/c429ab72-4816-4b74-8dc9-0178364d8d22" />

第一单开的做空BNB，做空信号强度0.56，做空价格1093
<img width="2276" height="1286" alt="QQ_1761902733179" src="https://github.com/user-attachments/assets/3020c0c1-382b-41c3-9a54-0393fd31833a" />
后续发现一个仓位计算的错误，导致bnb做空2次。。。修复




